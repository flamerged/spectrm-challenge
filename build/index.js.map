{"version":3,"sources":["../src/index.js"],"names":["port","process","env","PORT","Message","models","db","authenticate","then","console","log","NODE_ENV","catch","error","app","use","express","json","urlencoded","extended","get","req","res","findAll","messages","promises","forEach","message","push","increment","Promise","all","status","send","id","params","where","length","Error","post","content","body","create","put","changes","update","returning","delete","destroy","listen"],"mappings":"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","sourcesContent":["import express from \"express\";\nimport { db } from \"./config/db\";\nimport models from \"../models/index\";\n\nconst port = process.env.PORT || 4000;\nconst { Message } = models;\n\ndb.authenticate()\n  .then(() => console.log(`connected to ${process.env.NODE_ENV} db`))\n  .catch((error) =>\n    console.log(\"something went wrong connecting to the database: \" + error)\n  );\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: true }));\n\n// Routes\n\n// Get all messages\n\napp.get(\"/messages\", async (req, res) => {\n  Message.findAll()\n    .then((messages) => {\n      const promises = [];\n      messages.forEach((message) =>\n        promises.push(message.increment(\"retrievedCounter\"))\n      );\n      return Promise.all(promises);\n    })\n    .then((messages) => res.status(200).send(messages))\n    .catch((error) => {\n      console.log(error);\n      res.status(404).json({ status: \"failed\", error: `${error}` });\n    });\n});\n\n// Get single message by ID\n\napp.get(\"/messages/:id\", async (req, res) => {\n  const id = req.params.id;\n\n  Message.findAll({ where: { id } })\n    .then((message) => {\n      if (message.length > 0) {\n        message[0].increment(\"retrievedCounter\");\n      } else {\n        throw new Error(\"Message could not be found\");\n      }\n      res.status(200).send(message);\n    })\n    .catch((error) => {\n      console.log(error);\n      res.status(404).json({ status: \"failed\", error: `${error}` });\n    });\n});\n\n// Create a message\n\napp.post(\"/messages/\", async (req, res) => {\n  const { content } = req.body;\n\n  Message.create({ content })\n    .then((message) => res.status(201).send(message))\n    .catch((error) => {\n      console.log(error);\n      res.status(400).json({ status: \"failed\", error: `${error}` });\n    });\n});\n\n// Update a message by ID\n\napp.put(\"/messages/:id\", async (req, res) => {\n  const changes = req.body;\n  const id = req.params.id;\n\n  Message.update({ ...changes }, { where: { id }, returning: true })\n    .then((message) => {\n      message = message[1][0].increment(\"retrievedCounter\");\n      return message;\n    })\n    .then((message) => {\n      res.status(202).send({ status: \"success\", message });\n    })\n    .catch((error) => {\n      console.log(error);\n      res.status(400).json({ status: \"failed\", error: `${error}` });\n    });\n});\n\n// delete a message by ID\n\napp.delete(\"/messages/:id\", async (req, res) => {\n  const id = req.params.id;\n\n  Message.destroy({ where: { id }, returning: true })\n    .then((status) => {\n      if (status === 0) {\n        throw new Error(\"Message could not be found\");\n      }\n      res.status(202).send({ status: \"success\" });\n    })\n    .catch((error) => {\n      console.log(error);\n      res.status(400).json({ status: \"failed\", error: `${error}` });\n    });\n});\n\napp.listen(port, () => {\n  console.log(`App started on port ${port}`);\n});\n"],"file":"index.js"}